opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.4, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
i
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.4, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
dev.off()
dev.off()
dev.off()
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.4, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
i
dev.off()
dev.off()
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.4, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.8, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 2)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 2)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.8, out, cex = 1.5, hlines = T, yjust = 1)
mtext(id[i,2], 2, cex = 2, line = 1)
par(opar)
dev.off()
}
library(BAStag)
library(geosphere)
library(plotrix)
wd <- "D:/Dropbox/Science/Projects/GreatKnot"
fls <- list.files(wd, pattern = "summary.csv", recursive = TRUE)
id <- data.frame(GeoID  = substring(fls, 9, 12),
FlagID =c("XJN", "XJX", "XHS", "XHV", "XHU", "XNB", "XNC", "JRU"))
for(i in 1:length(fls)) {
tmp01 <- read.csv(paste(wd, fls[i], sep = "/"))
tmp01$Time1 <- as.POSIXct(tmp01$Time1, tz = "GMT")
tmp01$Time2 <- as.POSIXct(tmp01$Time2, tz = "GMT")
tmp01$id <- id[i,2]
if(i==1) {
tab <- tmp01
} else {
tab <- rbind(tab, tmp01)
}
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 4)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 14)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.8, out, cex = 1.5, hlines = T, yjust = 1)
mtext(paste(id[i,1], id[i,2], sep = "-"), 2, cex = 2, line = 1)
par(opar)
dev.off()
}
fls.light <- list.files(wd, pattern = "*.lux", recursive = TRUE)
for(i in 1:length(fls)) {
pdf(paste0(wd, "/FigCheck", i, ".pdf"), height = 17, width = 24)
opar <- par(mfrow = c(2, 1))
d.lux <-  read.table(paste(wd, fls.light[i], sep="/"), header = FALSE, skip = 25,
col.names = c("Date","Time", "Light"),
colClasses = c("character", "character", "numeric"))
d.lux$Date <- as.POSIXct(strptime(paste(d.lux$Date, d.lux$Time), "%d/%m/%Y %H:%M:%S", tz = "GMT"))
d.lux$Light <- log(d.lux$Light)
tmp1 <- tab[tab$id==id[i,2],]
tm <- as.POSIXct(apply(cbind(tmp1[,1], tmp1[,2]), 1 , mean), tz="GMT", origin="1970-01-01")
site <- tmp1$Site
arr <- tm[which(!is.na(site) & !duplicated(site) & site>0)]
dep <- tm[which(!is.na(site) & !duplicated(site, fromLast = T) & site>0)]
out <- data.frame(Site =  letters[1:length(arr)], Arrival = arr, Departure = dep)
if(!is.na(site[1])) out$Arrival[1] <- NA
if(!is.na(site[length(tm)])) out$Departure[nrow(out)] <- NA
d.lux <- subset(d.lux, Date>=(out[1,3]-20*24*60*60) & Date <=(out[nrow(out), 2]+20*24*60*60))
offset <- 3
par(mar = c(5,7,5,1))
lightImage(d.lux, offset = offset, zlim = c(0,12), xaxt = "n", xlab = "", ylab = "")
abline(v = out$Departure, lty = 2, col = "blue", lwd = 4)
abline(v = out$Arrival, lty = 2, col = "firebrick", lwd = 4)
text(out$Departure, 28.5, format(out$Departure, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "blue")
text(out$Arrival, 0, format(out$Arrival, "%b-%d"), srt = 90, xpd = T, pos = 3,  col = "firebrick")
out$Days <- round(apply(out, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out$Lon <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,2],1)
out$Lat <- round(aggregate(tmp1[tmp1$Site>0, c("Lon.50.", "Lat.50.")], by = list(tmp1$Site[tmp1$Site>0]), median)[,3],1)
tmp2      <- data.frame(Site = paste0("mig", 1:(nrow(out)-1)), Arrival = out$Departure[-nrow(out)],
Departure = out$Arrival[-1], Days = NA, Lon = NA, Lat = NA)
tmp2$Days <- round(apply(tmp2, 1, function(x) as.numeric(difftime(x[3], x[2], units = "days"))),2)
out <- rbind(out, tmp2)
out <- out[order(out[,3]),]
out$Distance <- NA
for(k in 1:nrow(out)) {
if(is.na(out$Lat[k])){
out$Distance[k] <- round(distVincentySphere(c(out$Lon[k-1], out$Lat[k-1]),
c(out$Lon[k+1], out$Lat[k+1]))/1000,1)
}
}
out$speed.max <- round(out$Distance/((out$Days-1)*24),1)
out$speed.mean <- round(out$Distance/((out$Days)*24),1)
out$speed.min <- round(out$Distance/((out$Days+1)*24),1)
par(mar = c(0,7,0,0))
plot(1,1, xaxt = "n", yaxt = "n", xlab = "", ylab = "", bty = "n", type = "n")
addtable2plot(x = 0.6, y = 0.8, out, cex = 1.5, hlines = T, yjust = 1)
mtext(paste(id[i,1], id[i,2], sep = "-"), 2, cex = 2, line = 1)
par(opar)
dev.off()
}
